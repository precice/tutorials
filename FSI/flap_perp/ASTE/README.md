## Overview

This tutorial is an example how the Artificial Solver Testing Environment (aste) can be used. The idea is that you run a coupled simulation with two regular solvers and save the coupling data in every timestep. Then, this data is converted to aste-format. Finally, aste substitutes one of the solvers and the simulation can be "replayed" using only one solver and aste with the prior results.

The base simulation for this tutorial is the OpenFOAM-FEniCS perpendicular flap tutorial. aste then substitutes OpenFOAM.

## Requirements

To run this tutorial you need to install the following components:
- preCICE
- ASTE
- FEniCS
- FEniCS-Adapter
- OpenFOAM
- OpenFOAM Adapter

Make sure to add aste/build to the path such that the python scripts can be found from anywhere.

## Step-by-Step explanations

### Generating vtk output during a simulation

The base case for this tutorial is the OpenFOAM-FEniCS perpendicular flap tutorial. So we start in the the root-directory of that simulation.
To generate a vtk output in preCICE, we add the following line to ```precice-config.xml``` after [line 41](https://github.com/precice/tutorials/blob/develop/FSI/flap_perp/OpenFOAM-FEniCS/precice-config.xml#L41) in the Solid participant:
```<export:vtk directory="preCICE-output" />```

Then, the simulation can be run in two terminals with ```bash ./runFluid``` and ```python3 Solid/perp_flap.py```.
The exports are in the ```preCICE-output``` directory.

### Converting the output to aste format.

We copy the ```preCICE-output``` folder to the root directory of the aste tutorial. 
To convert the files to the correct format we open the ```preCICE-output``` folder and run

```precice_to_aste.py -n 500 -f Forces0 --datadim 3```

### Replay of the simulation with aste

#### The quick way to run 
Copy perp_flap.py from OpenFOAM-FEniCS/Solid to aste/Solid

run in two terminals ```python3 Solid/perp_flap.py``` and ```preciceMap -v -c precice-config.xml -p A --mesh preCICE-output/Solid-fenics --vectordata```

Read on if you want to know what to change in the configuration files starting from the OpenFOAM-FEniCS tutorial.

#### The way to do it yourself

The aste-FEniCS simulation has its own ```precice-config.xml``` and ```precice-adapter-config-fsi-s.json```. 
However, these can be generated by modifiying the files from the OpenFOAM-FEniCS case. 

For ```precice-adapter-config-fsi-s.json``` we remove the line ```"write_data_name": "Displacements0",``` because we don't write data to aste.
Plus, we change to the ```read_data_name``` from ```Forces0``` to ```Data``` since aste works with the general data name ```Data```.

In ```precice-config.xml``` we need more changes
Again, we rename ```Forces0``` to ```Data``` throughout the whole file.

Then, we substitute the Fluid meshes and the Fluid participant with aste:

- Rename ```Fluid-Mesh-Faces``` to ```MeshA``` throughout the whole file. This is the mesh where 
- Delete the ```mesh``` ```"Fluid-Mesh-Nodes"``` and all lines where ```"Fluid-Mesh-Nodes"``` occurs.
- Rename 






