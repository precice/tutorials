version: "3.9"
services:
  prepare:
    image: ubuntu:latest
    user: ${MY_UID}:${MY_GID}
    volumes:
      - /etc/passwd:/etc/passwd:ro #TODO: Maybe move those into a more general section ? 
      - /etc/group:/etc/group:ro
      - {{ run_directory }}:/runs
    command: >
      /bin/bash -c "id &&
      cd '/runs/{{ tutorial_folder }}' &&
      tar -zxf reference-output.tar.gz &&
      sed -i '/<participant name="[A-Za-z]\+">/a <export:vtk directory=\"../preCICE-output\" />' precice-config.xml &&
      sed -i 's|m2n:sockets from|m2n:sockets network=\"eth0\" from|g' precice-config.xml &&
      cat precice-config.xml"

  
  {% for service in services %}
  {{ service }}:
    {{ services[service] |indent(4) }}
  {% endfor %}