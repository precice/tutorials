<?xml version="1.0" ?>
<precice-configuration>
   
    <log>
    <sink type="stream" 
	output="stdout"
 	filter= "(%Severity% > trace and %Rank% = 0)"
	format="(%Rank%) [%Module%]:%Line% in %Function%: %Severity% %Message%"
       	enabled="true" />  
    </log>

    <solver-interface dimensions="3">
    	<data:vector name="Force"/>
    	<data:vector name="Displacement"/>

    <mesh name="Fluid-Mesh-Faces">
        <use-data name="Force"/>
    </mesh>

    <mesh name="Fluid-Mesh-Nodes">
        <use-data name="Displacement"/>
    </mesh>

    <mesh name="Solid-Mesh">
        <use-data name="Force"/>
        <use-data name="Displacement"/>
    </mesh>

    <participant name="Fluid">
	<use-mesh name="Fluid-Mesh-Faces" provide="yes"/>
        <use-mesh name="Fluid-Mesh-Nodes" provide="yes"/>
        <use-mesh name="Solid-Mesh" from="Solid"/>
        <write-data name="Force" mesh="Fluid-Mesh-Faces"/>
        <read-data name="Displacement" mesh="Fluid-Mesh-Nodes"/>
        <mapping:rbf-thin-plate-splines
	  direction="write" 
	  from="Fluid-Mesh-Faces" 
	  to="Solid-Mesh" 
	  constraint="conservative" 
	  z-dead="true" />
        <mapping:rbf-thin-plate-splines
	  direction="read" 
	  from="Solid-Mesh" 
	  to="Fluid-Mesh-Nodes" 
	  constraint="consistent" />
    </participant>

    <participant name="Solid">
        <use-mesh name="Solid-Mesh" provide="yes"/>
        <read-data name="Force" mesh="Solid-Mesh"/>
        <write-data name="Displacement" mesh="Solid-Mesh"/>
        <watch-point mesh="Solid-Mesh" name="flaptip" coordinate="0.6;0.2;0.0" />
    </participant>

    <m2n:sockets from="Fluid" to="Solid" exchange-directory="../" />

    <coupling-scheme:serial-implicit>
            <time-window-size value="0.0005" />
            <max-time value="20"/>
            <participants first="Fluid" second="Solid"/>
            <exchange data="Force" mesh="Solid-Mesh" from="Fluid" to="Solid"/>
            <exchange data="Displacement" mesh="Solid-Mesh" from="Solid" to="Fluid" initialize="1" />

            <max-iterations value="100"/>
            <relative-convergence-measure limit="1e-6" data="Displacement" mesh="Solid-Mesh"/>
            <relative-convergence-measure limit="1e-2" data="Force" mesh="Solid-Mesh"/>

             <acceleration:IQN-ILS>
                <data name="Displacement" mesh="Solid-Mesh"/>
                <preconditioner type="residual-sum"/>
                <filter type="QR1" limit="1e-6"/>
                <initial-relaxation value="0.1"/> 
                <max-used-iterations value="100"/>
                <time-windows-reused value="10"/> 
            </acceleration:IQN-ILS> 
    </coupling-scheme:serial-implicit>
    </solver-interface>
</precice-configuration>
